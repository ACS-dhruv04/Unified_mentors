<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Super Mall App - Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: #ecf0f1;
    }

    .header {
      background: #2c3e50;
      box-shadow: 0 2px 8px rgba(44, 62, 80, 0.05);
    }

    .container.header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .app-name img {
      height: 80px;
      width: 130px;
      margin: 0;
    }

    .btn.logout-btn {
      background: #f39c12;
      color: #fff;
      font-weight: 600;
      border: none;
      padding: 0.65rem 1.4rem;
      border-radius: 7px;
      font-size: 1.01rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn.logout-btn:hover {
      background: #d07700;
    }

    .dashboard-wrapper {
      display: flex;
      min-height: 500px;
      max-width: 1200px;
      margin: 2rem auto;
      box-shadow: 0 6px 22px 0 rgba(0, 0, 0, 0.09);
      border-radius: 1.2rem;
      background: #fff;
      overflow: hidden;
    }

    .sidebar {
      background: #2c3e50;
      min-width: 200px;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar ul li {
      margin-bottom: 2rem;
    }

    .sidebar ul li:last-child {
      margin-bottom: 0;
    }

    .sidebar a {
      color: #ecf0f1;
      font-size: 1.10rem;
      font-weight: 600;
      padding: 0.7rem 1.2rem;
      border-radius: 6px;
      text-decoration: none;
      display: block;
      transition: background 0.18s, color 0.18s;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: #f39c12;
      color: #fff;
    }

    .icon {
      width: 40px;
      height: 40px;
      vertical-align: middle;
      margin-right: 10px;
      opacity: 0.8;
    }

    .main-content {
      flex: 1;
      padding: 2.2rem 2.5rem;
      background: #f8f9fb;
    }

    .welcome-section {
      margin-bottom: 2.5rem;
      padding: 1.6rem 1rem 1rem 1rem;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(44, 62, 80, 0.08);
    }

    .welcome-section h2 {
      color: #2c3e50;
      font-size: 2rem;
      margin: 0 0 0.8rem 0;
      font-weight: 600;
    }

    .welcome-section p {
      color: #718093;
      font-size: 1.19rem;
      margin: 0 0 0.6rem 0;
    }

    .admin-section,
    .user-section {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(44, 62, 80, 0.08);
      padding: 1.3rem 1rem 1.1rem 1.2rem;
      margin-bottom: 2rem;
    }

    .admin-section h3,
    .user-section h3 {
      color: #f39c12;
      font-size: 1.18rem;
      margin: 0 0 0.7rem 0;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .admin-section p,
    .user-section p {
      color: #2c3e50;
      margin-bottom: 0.9rem;
    }

    .admin-section ul {
      list-style: disc;
      padding-left: 1.5rem;
      margin: 0;
    }

    .admin-section ul li {
      margin-bottom: 0.65rem;
    }

    .admin-section ul li a {
      color: #2c3e50;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.19s;
    }

    .admin-section ul li a:hover {
      color: #f39c12;
    }

    @media (max-width: 900px) {
      .dashboard-wrapper {
        flex-direction: column;
        margin: 1rem;
        min-height: unset;
      }

      .sidebar {
        min-width: 100%;
        flex-direction: row;
        justify-content: center;
        gap: 2rem;
        padding: 1.3rem 0;
        border-radius: 1.2rem 1.2rem 0 0;
      }

      .sidebar ul {
        display: flex;
        justify-content: center;
        gap: 1.2rem;
      }

      .sidebar ul li {
        margin-bottom: 0;
      }

      .main-content {
        padding: 1.5rem 1rem;
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 1rem 0;
      }

      .container.header-content,
      .dashboard-wrapper {
        padding: 0 0.5rem;
        max-width: 100vw;
      }
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="container header-content">
      <h1 class="app-name"><img src="images/logo.png" alt="mall"></h1>
      <button id="logoutBtn" class="btn logout-btn">Logout</button>
    </div>
  </header>

  <div class="dashboard-wrapper">
    <nav class="sidebar">
      <ul>
        <li><a href="shops.html"><img src="images/shop.png" alt="" class="icon">Shops</a></li>
        <li><a href="offers.html"><img src="images/discount.png" alt="" class="icon">Offers</a></li>
        <li><a href="products.html"><img src="images/product.png" alt="" class="icon">Products</a></li>
      </ul>
    </nav>

    <main class="main-content">
      <section class="welcome-section">
        <h2>Welcome, <span id="userName">User</span>!</h2>
        <p>This is your dashboard where you can manage your activities.</p>
      </section>

      <!-- Admin-specific content -->
      <section id="adminSection" class="admin-section" style="display:none;">
        <h3>Admin Panel</h3>
        <p>Manage shops, offers, and products here.</p>
        <ul>
          <li><a href="shops.html">Manage Shops</a></li>
          <li><a href="offers.html">Manage Offers</a></li>
          <li><a href="products.html">Manage Products</a></li>
        </ul>
      </section>

      <!-- User-specific content -->
      <section id="userSection" class="user-section" style="display:none;">
        <h3>Your Activities</h3>
        <p>View your favorite shops, applied offers, and saved products.</p>
        <!-- Additional user specific widgets or info can be added here -->
      </section>
    </main>
  </div>

  <script src="firebase-config.js"></script>
  <script src="auth.js"></script>
  <script src="logger.js"></script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  // Check for the existence of the auth and logger modules
  if (typeof auth === 'undefined' || typeof logger === 'undefined') {
    alert('App initialization error: Missing required modules.');
    return;
  }

  // Get the currently logged in user
  const user = auth.getCurrentUser();

  // Redirect to login if not authenticated
  if (!user || !user.role) {
    window.location.href = "login.html";
    return;
  }

  // Safely update the welcome message
  const userNameElem = document.getElementById("userName");
  if (userNameElem && user.name) {
    userNameElem.textContent = user.name;
  } else if (userNameElem) {
    userNameElem.textContent = "User";
  }

  // Show or hide section based on user role
  const adminSection = document.getElementById("adminSection");
  const userSection = document.getElementById("userSection");
  if (user.role.toLowerCase() === "admin") {
    if (adminSection) adminSection.style.display = "block";
    if (userSection) userSection.style.display = "none";
  } else {
    if (adminSection) adminSection.style.display = "none";
    if (userSection) userSection.style.display = "block";
  }

  // Set up logout logic
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      auth.logout().then(() => {
        window.location.href = "login.html";
      });
    });
  }

  // Log the dashboard visit action
  logger.logAction(user.uid || user.email || "unknown", "Visited dashboard");
});
</script>

</body>

</html>